<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="fourjo.idle.goodgame.gg.repository.AdminReplyRepository">



    <delete id="replyDeleteByUserIndex" parameterType="integer">
        delete from reply_mst where replyIndex=#{relpyIndex}
    </delete>

    <select id="replySearchByUserNickAndReplyContent"  parameterType="fourjo.idle.goodgame.gg.web.dto.AdminReplySearchDTO" resultType="fourjo.idle.goodgame.gg.web.dto.ReplyDto">
        select
        rm.replyIndex as replyIndex,
        rm.boardIndex as boardIndex,
       rm.userId as userId,
        rm.replyContent as replyContent,
        rm.replyGroup as replyGroup,
        rm.replySequence as replySequence,
        rm.replyRegDate as replyRegDate
        from reply_mst rm
       join user_mst um on (rm.userId = um.userIndex)
       <if test='searchKey == "cn" and  searchValue != null and searchValue !=""'>
            where (
            rm.replyContent like CONCAT('%',#{searchValue},'%') or
            um.userNick like CONCAT('%', #{searchValue}, '%')
            )
        </if>
        <if test='searchKey == "c" '>
            where rm.replyContent like CONCAT('%',#{searchValue},'%')

        </if>
        <if test='searchKey == "n" '>
            where um.userNick like CONCAT('%', #{searchValue}, '%')

        </if>
        order by
       replyIndex desc
        <if test='limit == "Y"'>
            limit #{index}, #{count}
        </if>

    </select>
</mapper>